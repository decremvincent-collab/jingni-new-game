<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ÏπòÌÇ® Îü∞ ‚Äì Platformer</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
    html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: black;
        touch-action: none;
        font-family: sans-serif;
    }

    /* Monde plus haut pour √©viter la bande noire */
    #game {
        position: relative;
        width: 4000px;
        height: 1000px;
        background-image: url('https://preview.redd.it/idol-star-gojo-satoru-v0-ir8mjw5996tb1.gif?width=640&crop=smart&auto=webp&s=3f60c4ffc5f2358c8b019ef6306475f229be86e8');
        background-size: cover;       /* UNE SEULE IMAGE */
        background-repeat: no-repeat;
        background-position: center;
    }

    #camera {
        position: absolute;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        touch-action: none;
    }

    /* Personnage */
    #player {
        position: absolute;
        width: 300px;
        height: 300px;
        background-image: url('https://scontent.xx.fbcdn.net/v/t1.15752-9/627764165_1645091116931275_235186095692944776_n.png');
        background-size: cover;
        background-position: center;
    }

    /* Plateformes */
    .platform {
        position: absolute;
        background: rgba(255,255,255,0.3);
        border: 2px solid white;
        border-radius: 5px;
    }

    /* Items */
    .item {
        position: absolute;
        font-size: 40px;
    }

    /* Score */
    #score {
        position: fixed;
        top: 20px;
        left: 20px;
        font-size: 28px;
        color: #ffb7d5;
        text-shadow: 0 0 5px black;
        z-index: 10;
    }

    /* Vie */
    #life {
        position: fixed;
        top: 20px;
        right: 20px;
        font-size: 28px;
        color: #ff6b6b;
        text-shadow: 0 0 5px black;
        z-index: 10;
    }

    /* Message EN HAUT */
    #messageBox {
        position: fixed;
        top: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.6);
        padding: 15px 25px;
        border-radius: 10px;
        color: white;
        font-size: 22px;
        display: none;
        z-index: 20;
    }

    /* Victoire */
    #win {
        position: fixed;
        top: 30%;
        width: 100%;
        text-align: center;
        font-size: 40px;
        color: #ffb7d5;
        display: none;
        text-shadow: 0 0 10px #ff4da6;
        z-index: 30;
    }

    #surpriseBtn {
        padding: 12px 25px;
        font-size: 22px;
        background: #ffb7d5;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        color: white;
        margin-top: 20px;
    }
</style>
</head>
<body>

<div id="score">Ï†êÏàò : 0</div>
<div id="life">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
<div id="messageBox"></div>

<div id="camera">
    <div id="game">

        <div id="player"></div>

        <!-- Plateformes -->
        <div class="platform" style="left:300px; top:600px; width:300px; height:20px;"></div>
        <div class="platform" style="left:900px; top:500px; width:250px; height:20px;"></div>
        <div class="platform" style="left:1500px; top:550px; width:300px; height:20px;"></div>
        <div class="platform" style="left:2300px; top:450px; width:350px; height:20px;"></div>

        <!-- Items -->
        <div class="item" data-type="chicken" style="left:200px; top:850px;">üçó</div>
        <div class="item" data-type="chicken" style="left:600px; top:850px;">üçó</div>
        <div class="item" data-type="carrot" style="left:800px; top:850px;">ü•ï</div>
        <div class="item" data-type="chicken" style="left:1000px; top:450px;">üçó</div>
        <div class="item" data-type="carrot" style="left:1300px; top:850px;">ü•ï</div>
        <div class="item" data-type="chicken" style="left:1600px; top:500px;">üçó</div>
        <div class="item" data-type="carrot" style="left:1900px; top:850px;">ü•ï</div>
        <div class="item" data-type="toilet" style="left:2100px; top:850px;">üöΩ</div>
        <div class="item" data-type="chicken" style="left:2600px; top:400px;">üçó</div>
        <div class="item" data-type="chicken" style="left:3000px; top:850px;">üçó</div>
        <div class="item" data-type="carrot" style="left:3300px; top:850px;">ü•ï</div>
        <div class="item" data-type="chicken" style="left:3600px; top:850px;">üçó</div>

    </div>
</div>

<div id="win">
    Ï∂ïÌïòÌï¥! 30Í∞úÏùò ÏπòÌÇ®ÏùÑ Î™®ÏïòÏñ¥!<br><br>
    <button id="surpriseBtn">üéÅ ÏÑúÌîÑÎùºÏù¥Ï¶à Î≥¥Í∏∞</button>
</div>

<script>
let player = document.getElementById("player");
let camera = document.getElementById("camera");
let game = document.getElementById("game");
let scoreDisplay = document.getElementById("score");
let lifeDisplay = document.getElementById("life");
let messageBox = document.getElementById("messageBox");

let x = 50, y = 850;  
let vx = 0, vy = 0;
let speed = 2;
let gravity = 0.7;   /* GRAVIT√â AUGMENT√âE */
let jumping = false;

let score = 0;
let life = 3;

let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

/* MOBILE : saut tactile */
document.addEventListener("touchstart", () => {
    if (!jumping) {
        vy = -18;
        jumping = true;
    }
});

function updateLife() {
    if (life === 3) lifeDisplay.textContent = "‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è";
    if (life === 2) lifeDisplay.textContent = "‚ù§Ô∏è‚ù§Ô∏èüñ§";
    if (life === 1) lifeDisplay.textContent = "‚ù§Ô∏èüñ§üñ§";
    if (life === 0) lifeDisplay.textContent = "üñ§üñ§üñ§";
}

function showMessage(text) {
    messageBox.textContent = text;
    messageBox.style.display = "block";
    setTimeout(() => messageBox.style.display = "none", 2000);
}

function loop() {

    if (keys["a"]) vx = -speed;
    else if (keys["d"]) vx = speed;
    else vx = 0;

    if ((keys["w"] || keys[" "]) && !jumping) {
        vy = -18;   /* SAUT PLUS HAUT */
        jumping = true;
    }

    vy += gravity;

    x += vx;
    y += vy;

    if (y > 850) {
        y = 850;
        vy = 0;
        jumping = false;
    }

    document.querySelectorAll(".platform").forEach(p => {
        let rect = p.getBoundingClientRect();
        let px = rect.left + camera.scrollLeft;
        let py = rect.top + camera.scrollTop;

        if (
            x + 300 > px &&
            x < px + rect.width &&
            y + 300 > py &&
            y + 300 < py + 20 &&
            vy > 0
        ) {
            y = py - 300;
            vy = 0;
            jumping = false;
        }
    });

    document.querySelectorAll(".item").forEach(item => {
        let rect = item.getBoundingClientRect();
        let px = rect.left + camera.scrollLeft;
        let py = rect.top + camera.scrollTop;

        if (
            x + 300 > px &&
            x < px + rect.width &&
            y + 300 > py &&
            y < py + rect.height
        ) {
            let type = item.dataset.type;

            if (type === "chicken") {
                score++;
                scoreDisplay.textContent = "Ï†êÏàò : " + score;
                if (score >= 30) win();
            }

            if (type === "carrot") {
                life--;
                updateLife();
                if (life <= 0) lose();
            }

            if (type === "toilet") {
                if (life < 3) life++;
                updateLife();
                showMessage("üöΩ ÌôîÏû•Ïã§ÏùÄ ÎãπÍ∑ºÏùÑ ÏóÜÏï†Îäî Îç∞ ÏµúÍ≥†Ïïº!");
            }

            item.remove();
        }
    });

    /* --- CAM√âRA CORRIG√âE --- */
    camera.scrollLeft = x - window.innerWidth / 2;
    camera.scrollTop = y - window.innerHeight / 2;

    if (camera.scrollLeft < 0) camera.scrollLeft = 0;
    if (camera.scrollLeft > game.offsetWidth - window.innerWidth)
        camera.scrollLeft = game.offsetWidth - window.innerWidth;

    if (camera.scrollTop < 0) camera.scrollTop = 0;
    if (camera.scrollTop > game.offsetHeight - window.innerHeight)
        camera.scrollTop = game.offsetHeight - window.innerHeight;

    player.style.left = x + "px";
    player.style.top = y + "px";

    requestAnimationFrame(loop);
}

loop();

function win() {
    document.getElementById("win").style.display = "block";
    document.getElementById("surpriseBtn").onclick = () => {
        window.location.href = "page_messages.html";
    };
}

function lose() {
    showMessage("ü•ï Í≤åÏûÑ Ïò§Î≤Ñ!");
}
</script>

</body>
</html>
